About:

This app is dedicated to my daughter. May this app improve the security of organisations great and small.

Auditd logs are the single richest and most precise source of auditing information available in GNU/Linux, however they are too often underutilised due to their complexity. This app and its TA make that information readily accessible at enterprise-scale in three mobile-friendly dashboards together with various field extractions, lookups and CIM mappings for Enterprise Security. For example, the event below is mostly comprised of easily parsed key-value pairs, however this app uses the "arch" and "syscall" number to resolve the system call made and determine the posix user from the auid ("actual uid" of the user who executed the process) for searching and correlation in Enterprise Security.

type=SYSCALL msg=audit(1321390138.034:228150): arch=c000003e syscall=62 success=yes exit=0 a0=14a3 a1=0 a2=7fcfa39 a3=12a0 items=0 ppid=19051 pid=19128 auid=3045 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=7643 comm="splunkd" exe="/opt/splunk/bin/splunkd" subj=system_u:system_r:splunk_t:s0 key=(null)

Installation:

Auditd events (sourcetype=linux:audit OR sourcetype=linux_audit) are collected using the Splunk App for Unix and Linux's "Splunk_TA_nix" app deployed to forwarders or a simple inputs monitor stanza on /var/log/audit/audit.log with the sourcetype 'linux:audit'. This linux-auditd app and its TA_linux-auditd add-on need only be installed on search heads in environments not using accelerated CIM-based datamodels (ie. if you don't have the Enterprise Security app installed). To install the TA_linux-auditd app, simply copy it from linux-auditd/appserver/addons/ to $SPLUNK_HOME/etc/apps/; restart Splunk; and the "TA Status" pane on the welcome dashboard should display "Working". For your convenience, should it be necessary (ie. for collecting auditd events via syslog), we have included a syslog transform; in that case, uncomment the provided prop in TA_linux-auditd and deploy to your syslog collection heavyforwarder/indexer servers.

As noted above, the TA will resolve uid values to posix usernames. For this to occur, two lookups require populating. The first contains local users (typically created by package management) and can be extracted from /etc/passwd using the following command: awk -F ':' 'BEGIN {print "uid,user"} {print $3","$1}' /etc/passwd > /opt/splunk/etc/apps/TA_linux-auditd/lookups/local_posix_identities.csv

The second lookup contains directory users and can be populated by scheduling the following search to run periodically with the SA-ldapsearch app: |ldapsearch search="(&(objectclass=user)(uidNumber=*))" attrs="sAMAccountName,uidNumber" | rename sAMAccountName as user, uidNumber as uid | table uid user | outputlookup directory_posix_identities

For improved dashboard performance in large environments, it's recommended to create a local eventtypes.conf in the TA_linux-auditd app to override the default "index=*", explicitly specifying the indices where auditd events are stored in your environment.
